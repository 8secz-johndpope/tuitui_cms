(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{1009:function(e,t,a){"use strict";a.r(t);var n=a(36),r=a(9),i=a(44),l=a(45),c=a(48),s=a(46),o=a(268),u=a(47),d=a(0),p=a.n(d),m=a(88),h=a(806),f=a(831),k=a(801),g=a(827),b=a(995),v=a(824),I=a(105),E=a(57),L=a(95),y=a(5),S={spreadLinkInfo:{id:"",title:"",links:[],weights:[],back_urls:[],link:"",back_url:"",weight:"",type:!1,status:!1,granularity:1,group:"",remarks:""},tagList:[],index:-1},C=function(e){function t(e){var a;return Object(i.a)(this,t),(a=Object(c.a)(this,Object(s.a)(t).call(this,e))).state=Object(r.a)({},S),a.addTag=a.addTag.bind(Object(o.a)(a)),a.cancelSelectTag=a.cancelSelectTag.bind(Object(o.a)(a)),a.cancelEdit=a.cancelEdit.bind(Object(o.a)(a)),a.submitSpreadLink=a.submitSpreadLink.bind(Object(o.a)(a)),a.cancelUpdate=a.cancelUpdate.bind(Object(o.a)(a)),a}return Object(u.a)(t,e),Object(l.a)(t,[{key:"componentWillMount",value:function(){var e=this.props.history.location.query;e&&this.initData(e),this.getTagList()}},{key:"render",value:function(){var e,t,a,n,r,i=this,l=this.state,c=l.spreadLinkInfo,s=l.tagList,o=l.index,u=c.title,m=c.links,E=c.weights,L=c.back_urls,y=c.link,S=c.back_url,C=c.weight,O=c.type,j=c.status,w=c.granularity,T=c.group,N=c.remarks;return m.length>0&&(t=p.a.createElement(h.a.Item,{label:"\u94fe\u63a5\u7ec4"},p.a.createElement(f.a,{size:"small",bordered:!0,dataSource:m,renderItem:function(e,t){return p.a.createElement(f.a.Item,{actions:[p.a.createElement("span",{className:"cursor",style:{color:"#f00"},onClick:function(){return i.delLink(t,"links")}},"del")]},e)}}))),L.length>0&&(a=p.a.createElement(h.a.Item,{label:"\u8fd4\u56de\u94fe\u63a5\u7ec4"},p.a.createElement(f.a,{size:"small",bordered:!0,dataSource:L,renderItem:function(e,t){return p.a.createElement(f.a.Item,{actions:[p.a.createElement("span",{className:"cursor",style:{color:"#f00"},onClick:function(){return i.delLink(t,"back_urls")}},"del")]},e)}}))),E.length>0&&(n=p.a.createElement(h.a.Item,{label:"\u6743\u91cd\u7ec4"},p.a.createElement(f.a,{size:"small",bordered:!0,dataSource:E,renderItem:function(e,t){var a;return a=o===t?[p.a.createElement("span",{className:"cursor",style:{color:"#f00"},onClick:i.cancelUpdate},"\u53d6\u6d88")]:[p.a.createElement("span",{className:"cursor",style:{color:"#f00"},onClick:function(e){return i.delLink(t,"weights",e)}},"\u5220\u9664")],p.a.createElement(f.a.Item,{onClick:function(){return i.updateWeight(t)},actions:a},o===t?p.a.createElement(k.a.Search,{size:"small",enterButton:"\u4fdd\u5b58",onSearch:function(e,t){return i.saveUpdate(e,t)}}):e)}}))),O&&(e=p.a.createElement(d.Fragment,null,p.a.createElement(h.a.Item,{label:"\u6743\u91cd"},p.a.createElement(k.a.Search,{value:C,enterButton:"\u6dfb\u52a0",placeholder:"\u8bf7\u8f93\u5165\u6743\u91cd",onChange:function(e){return i.changeInputValue(e.target.value,"weight")},onSearch:function(e){return i.addLink(e,"weights","weight")}})),n,p.a.createElement(h.a.Item,{label:"\u6295\u653e\u72b6\u6001"},p.a.createElement(g.a,{checked:j,onChange:function(e){return i.changeInputValue(e,"status")}})),p.a.createElement(h.a.Item,{label:"\u65f6\u95f4\u9897\u7c92\u5ea6"},p.a.createElement(b.a,{min:1,value:w,placeholder:"\u8bf7\u8f93\u5165\u6807\u9898",onChange:function(e){return i.changeInputValue(e,"granularity")}})))),r=T?p.a.createElement(v.a,{closable:!0,onClose:this.cancelSelectTag},T):p.a.createElement(k.a.Search,{enterButton:"\u786e\u5b9a",placeholder:"\u8bf7\u8f93\u5165\u6807\u7b7e",onSearch:this.addTag}),p.a.createElement("div",null,p.a.createElement("div",{className:"container"},p.a.createElement("div",{className:"title-wrapper"},p.a.createElement("h2",null,"\u7f16\u8f91\u63a8\u5e7f\u94fe\u63a5"),p.a.createElement("div",{className:"fr"},p.a.createElement(I.a,{type:"primary",style:{marginRight:10},onClick:this.submitSpreadLink},"\u63d0\u4ea4"),p.a.createElement(I.a,{onClick:this.cancelEdit},"\u53d6\u6d88"))),p.a.createElement(h.a,{className:"fl",style:{width:"60%",borderRight:"1px solid #eee"},labelCol:{sm:3},wrapperCol:{sm:18,offset:0},colon:!1},p.a.createElement(h.a.Item,{label:"\u6807\u9898"},p.a.createElement(k.a,{value:u,placeholder:"\u8bf7\u8f93\u5165\u6807\u9898",onChange:function(e){return i.changeInputValue(e.target.value,"title")}})),p.a.createElement(h.a.Item,{label:"\u94fe\u63a5"},p.a.createElement(k.a.Search,{value:y,enterButton:"\u6dfb\u52a0",placeholder:"\u8bf7\u8f93\u5165\u94fe\u63a5",onChange:function(e){return i.changeInputValue(e.target.value,"link")},onSearch:function(e){return i.addLink(e,"links","link")}})),t,p.a.createElement(h.a.Item,{label:"\u8fd4\u56de\u94fe\u63a5"},p.a.createElement(k.a.Search,{value:S,enterButton:"\u6dfb\u52a0",placeholder:"\u8bf7\u8f93\u5165\u8fd4\u56de\u94fe\u63a5",onChange:function(e){return i.changeInputValue(e.target.value,"back_url")},onSearch:function(e){return i.addLink(e,"back_urls","back_url")}})),a,p.a.createElement(h.a.Item,{label:"\u9009\u62e9\u6807\u7b7e"},r),p.a.createElement(h.a.Item,{label:"\u6807\u7b7e\u9009\u9879"},s.map(function(e,t){return p.a.createElement(v.a,{className:"cursor",closable:!0,onClose:function(a){return i.deleteTag(a,e._id,t)},key:e._id,onClick:function(){return i.selectTag(e.name)}},e.name)}))),p.a.createElement(h.a,{className:"fl",style:{width:"36%",paddingLeft:"4%"},labelCol:{sm:7},wrapperCol:{sm:17,offset:0},colon:!1},p.a.createElement(h.a.Item,{label:"\u662f\u5426\u589e\u52a0\u6743\u91cd"},p.a.createElement(g.a,{checked:O,onChange:function(e){return i.changeInputValue(e,"type")}})),e,p.a.createElement(h.a.Item,{label:"\u94fe\u63a5\u5907\u6ce8"},p.a.createElement(k.a,{value:N,placeholder:"\u8bf7\u8f93\u5165\u5907\u6ce8",onChange:function(e){return i.changeInputValue(e.target.value,"remarks")}})))))}},{key:"initData",value:function(e){e.type=1===e.type,e.status=1===e.status,this.setState(function(t){return{spreadLinkInfo:Object(r.a)({},t.spreadLinkInfo,{},e)}})}},{key:"changeInputValue",value:function(e,t){var a=this.state.spreadLinkInfo;a[t]=e,this.setState({spreadLinkInfo:a})}},{key:"addLink",value:function(e,t,a){var n=this.state.spreadLinkInfo;e.trim()?(n[t].push(e.trim()),n[a]="",this.setState(function(e){return{spreadLinkInfo:Object(r.a)({},e.spreadLinkInfo,{},n)}})):E.a.error("\u94fe\u63a5\u4e0d\u80fd\u4e3a\u7a7a")}},{key:"delLink",value:function(e,t,a){a&&a.stopPropagation();var n=this.state.spreadLinkInfo;n[t].splice(e,1),this.setState(function(e){return{spreadLinkInfo:Object(r.a)({},e.spreadLinkInfo,{},n)}})}},{key:"updateWeight",value:function(e){this.setState({index:e})}},{key:"saveUpdate",value:function(e,t){t.stopPropagation();var a=this.state,n=a.spreadLinkInfo,i=a.index;n.weights.splice(i,1,e),this.setState(function(e){return{spreadLinkInfo:Object(r.a)({},e.spreadLinkInfo,{},n),index:-1}})}},{key:"cancelUpdate",value:function(e){e.stopPropagation(),this.setState({index:-1})}},{key:"getTagList",value:function(){var e=this;y.a.get("/tuiguangTag").then(function(t){var a=t.data.data;e.setState({tagList:a})})}},{key:"addTag",value:function(e){var t=this,a=this.state.spreadLinkInfo;e.trim()?y.a.post("/tuiguangTag",{name:e.trim()}).then(function(i){if(0===i.data.exist){var l=i.data.data;t.setState(function(e){return{tagList:[].concat(Object(n.a)(e.tagList),[l])}})}a.group=e,t.setState(function(e){return{spreadLinkInfo:Object(r.a)({},e.spreadLinkInfo,{},a)}})}):E.a.error("\u6807\u7b7e\u540d\u4e0d\u80fd\u4e3a\u7a7a")}},{key:"selectTag",value:function(e){var t=this.state.spreadLinkInfo;t.group=e,this.setState(function(e){return{spreadLinkInfo:Object(r.a)({},e.spreadLinkInfo,{},t)}})}},{key:"cancelSelectTag",value:function(){var e=this.state.spreadLinkInfo;e.group="",this.setState(function(t){return{spreadLinkInfo:Object(r.a)({},t.spreadLinkInfo,{},e)}})}},{key:"deleteTag",value:function(e,t,a){var n=this;e.stopPropagation();var r=this.state.tagList;y.a.delete("/tuiguangTag",{params:{id:t}}).then(function(e){r.splice(a,1),n.setState({tagList:r})})}},{key:"submitSpreadLink",value:function(){var e=this,t=this.props.history.location.query,a=this.state.spreadLinkInfo;a.type=a.type?1:0,a.status=a.status?1:0;var n="/transfer/create";t&&(n="/transfer/update"),L.a.confirm({title:"\u786e\u5b9a\u63d0\u4ea4\u5417\uff1f",onOk:function(){y.a.post(n,Object(r.a)({},a)).then(function(t){t.data.success?(E.a.info(t.data.success),e.cancelEdit()):E.a.info(t.data.err)})}})}},{key:"cancelEdit",value:function(){this.props.history.goBack(),this.resetState()}},{key:"resetState",value:function(){this.setState(Object(r.a)({},S))}},{key:"componentWillUnmount",value:function(){this.resetState()}}]),t}(d.Component);t.default=Object(m.g)(C)}}]);